<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geschichtenklang Weberstein</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora&amp;family=Merriweather:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --parchment: #f9f2e8;
      --bronze: #b08d57;
      --thaum: #3466ff;
      --text: #2c2119;
      --max-width: 800px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--parchment);
      color: var(--text);
      font-family: 'Lora', serif;
      line-height: 1.6;
    }
    header {
      text-align: center;
      padding: 1rem;
    }
    h1, h2, h3 {
      font-family: 'Merriweather', serif;
    }
    header h1 {
      font-size: 2.5rem;
      margin: 0.2rem;
      color: var(--thaum);
    }
    header img {
      width: 80px;
      height: auto;
      display: block;
      margin: 0.5rem auto;
    }
    .tabs {
      display: flex;
      overflow-x: auto;
      border-top: 2px solid var(--bronze);
      border-bottom: 2px solid var(--bronze);
      background: var(--bronze);
    }
    .tabs button {
      flex: none;
      padding: 0.5rem 1rem;
      border: none;
      background: transparent;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tabs button:hover,
    .tabs button:focus {
      background: rgba(0,0,0,0.2);
      outline: none;
    }
    .tabs button.active {
      background: var(--thaum);
    }
    main {
      max-width: var(--max-width);
      margin: 1rem auto;
      padding: 0 1rem;
    }
    .story-panel {
      display: none;
      animation: fade 0.3s ease-in-out;
    }
    .story-panel.active {
      display: block;
    }
    .story-panel h2 {
      color: var(--thaum);
    }
    .divider {
      height: 4px;
      width: 100%;
      background: var(--bronze);
      margin: 0.5rem 0 1rem;
    }
    .story-text {
      white-space: pre-wrap;
    }
    .story-text.align-center {
      text-align: center;
    }
    .story-text.align-justify {
      text-align: justify;
    }
    .story-content {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: flex-start;
    }
    .story-content figure {
      margin: 0;
      flex: 1 1 300px;
      max-width: 300px;
    }
    .story-content figure.below {
      order: 2;
      flex-basis: 100%;
      max-width: none;
    }
    .story-content img {
      width: 100%;
      height: auto;
      display: block;
    }
    @media (max-width: 600px) {
      .story-content {
        flex-direction: column;
      }
    }
    footer {
      text-align: center;
      padding: 2rem 1rem;
      font-size: 0.9rem;
      border-top: 1px solid var(--bronze);
    }
    #admin-login {
      margin-top: 1rem;
      background: #c00;
      color: #fff;
      font-weight: bold;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    #cms {
      position: fixed;
      inset: 0;
      background: var(--parchment);
      overflow: auto;
      padding: 1rem;
    }
        #cms [contenteditable="true"] {
      white-space: pre-wrap;
      width: 100%;
      min-height: 6rem;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
    }
    .editor-toolbar {
      margin-bottom: 0.5rem;
    }
    .editor-toolbar button {
      margin-right: 0.25rem;
    }
    #cms .preview {
      display: block;
      max-width: 100px;
      margin: 0.5rem 0;
    }
    #overview {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      margin: 1rem;
    }
    #overview .tile {
      border: 2px solid var(--bronze);
      background: var(--parchment);
      display: flex;
      flex-direction: column;
      padding: 0.5rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    #overview .tile strong {
      display: block;
      text-align: center;
      margin-bottom: 0.25rem;
    }
    #overview .tile .tile-text {
      white-space: pre-wrap;
      display: block;
      margin: 0;
      font-size: 0.9rem;
    }
    #overview .tile:hover {
      background: var(--bronze);
      color: #fff;
    }
    #back-btn {
      margin: 1rem;
    }
    @keyframes fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <header>
    <img src="crest.svg" alt="Wappen" onerror="this.style.display='none'">
    <h1>Geschichtenklang Weberstein</h1>
    <p>Forschergeister – 13 Kurzgeschichten</p>
  </header>
  <section id="overview">
    <button class="tile" data-target="story1"><strong>Story 1</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story2"><strong>Story 2</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story3"><strong>Story 3</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story4"><strong>Story 4</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story5"><strong>Story 5</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story6"><strong>Story 6</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story7"><strong>Story 7</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story8"><strong>Story 8</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story9"><strong>Story 9</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story10"><strong>Story 10</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story11"><strong>Story 11</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story12"><strong>Story 12</strong><span class="tile-text">Kurzbeschreibung</span></button>
    <button class="tile" data-target="story13"><strong>Story 13</strong><span class="tile-text">Kurzbeschreibung</span></button>
  </section>
  <button id="back-btn" hidden>Zurück zur Übersicht</button>
  <nav class="tabs" role="tablist" hidden>
    <!-- 13 Buttons -->
    <button id="tab1" class="tab active" role="tab" aria-controls="story1" aria-selected="true" data-target="story1">1</button>
    <button id="tab2" class="tab" role="tab" aria-controls="story2" aria-selected="false" data-target="story2">2</button>
    <button id="tab3" class="tab" role="tab" aria-controls="story3" aria-selected="false" data-target="story3">3</button>
    <button id="tab4" class="tab" role="tab" aria-controls="story4" aria-selected="false" data-target="story4">4</button>
    <button id="tab5" class="tab" role="tab" aria-controls="story5" aria-selected="false" data-target="story5">5</button>
    <button id="tab6" class="tab" role="tab" aria-controls="story6" aria-selected="false" data-target="story6">6</button>
    <button id="tab7" class="tab" role="tab" aria-controls="story7" aria-selected="false" data-target="story7">7</button>
    <button id="tab8" class="tab" role="tab" aria-controls="story8" aria-selected="false" data-target="story8">8</button>
    <button id="tab9" class="tab" role="tab" aria-controls="story9" aria-selected="false" data-target="story9">9</button>
    <button id="tab10" class="tab" role="tab" aria-controls="story10" aria-selected="false" data-target="story10">10</button>
    <button id="tab11" class="tab" role="tab" aria-controls="story11" aria-selected="false" data-target="story11">11</button>
    <button id="tab12" class="tab" role="tab" aria-controls="story12" aria-selected="false" data-target="story12">12</button>
    <button id="tab13" class="tab" role="tab" aria-controls="story13" aria-selected="false" data-target="story13">13</button>
  </nav>
  <main hidden>
    <section id="story1" class="story-panel active" role="tabpanel" tabindex="0" aria-labelledby="tab1">
      <h2>Story 1</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Hier steht die erste Kurzgeschichte. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent vehicula tempor orci, sit amet dignissim nunc volutpat sed. Aliquam erat volutpat. Integer gravida velit quis dolor fermentum, ut efficitur turpis vulputate. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.
        </div>
        <figure>
          <img src="story1.jpg" alt="Bild zu Story 1" onerror="this.style.display='none'">
        </figure>
      </div>
    </section>
    <section id="story2" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab2">
      <h2>Story 2</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Dies ist der Platzhaltertext der zweiten Geschichte. Nullam convallis, erat non congue porttitor, massa erat ullamcorper augue, vel cursus dolor enim vel ligula.
        </div>
      </div>
    </section>
    <section id="story3" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab3">
      <h2>Story 3</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Dritte Geschichte. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.
        </div>
      </div>
    </section>
    <section id="story4" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab4">
      <h2>Story 4</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Vierte Geschichte. At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque.
        </div>
      </div>
    </section>
    <section id="story5" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab5">
      <h2>Story 5</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Fünfte Geschichte. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam.
        </div>
      </div>
    </section>
    <section id="story6" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab6">
      <h2>Story 6</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Sechste Geschichte. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
        </div>
      </div>
    </section>
    <section id="story7" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab7">
      <h2>Story 7</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Siebte Geschichte. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
      </div>
    </section>
    <section id="story8" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab8">
      <h2>Story 8</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Achte Geschichte. Vivamus efficitur, leo in porta luctus, dolor lectus tempor metus, at sagittis justo nulla non lacus.
        </div>
      </div>
    </section>
    <section id="story9" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab9">
      <h2>Story 9</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Neunte Geschichte. Sed cursus leo magna, ac facilisis lorem eleifend quis.
        </div>
      </div>
    </section>
    <section id="story10" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab10">
      <h2>Story 10</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Zehnte Geschichte. Cras vel diam sed urna venenatis dignissim in non tortor.
        </div>
      </div>
    </section>
    <section id="story11" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab11">
      <h2>Story 11</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Elfte Geschichte. Proin consequat libero at lorem tincidunt, eu bibendum tortor convallis.
        </div>
      </div>
    </section>
    <section id="story12" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab12">
      <h2>Story 12</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Zwölfte Geschichte. Aenean suscipit ligula at lorem tristique viverra.
        </div>
      </div>
    </section>
    <section id="story13" class="story-panel" role="tabpanel" tabindex="0" aria-labelledby="tab13">
      <h2>Story 13</h2>
      <div class="divider"></div>
      <div class="story-content">
        <div class="story-text">
Dreizehnte Geschichte. Integer eu velit nisl. Nulla facilisi.
        </div>
      </div>
    </section>
  </main>
  <footer>
    &copy; 2025 Philipp – Code unter MIT-Lizenz
    <button id="admin-login">Nicht drücken</button>
  </footer>
  <section id="cms" hidden>
    <h2>Geschichten verwalten</h2>
    <div id="cms-list"></div>
    <button id="cms-export">Export JSON</button>
    <button id="cms-save">Speichern</button>
    <button id="cms-close">Schließen</button>
  </section>
<script>
function showStory(el) {
  const btn = el.currentTarget || el;
  const id = btn.dataset.target;
  document.querySelectorAll('.tab').forEach(b => {
    b.classList.remove('active');
    b.setAttribute('aria-selected', 'false');
  });
  btn.classList.add('active');
  btn.setAttribute('aria-selected', 'true');
  document.querySelectorAll('.story-panel').forEach(p => {
    const active = p.id === id;
    p.classList.toggle('active', active);
  });
  document.getElementById(id).scrollIntoView({behavior: 'smooth', block: 'start'});
}

function openStory(id) {
  document.getElementById('overview').hidden = true;
  document.querySelector('.tabs').hidden = false;
  document.querySelector('main').hidden = false;
  document.getElementById('back-btn').hidden = false;
  const btn = document.querySelector(`.tab[data-target="${id}"]`);
  if (btn) showStory(btn);
}

function backToOverview() {
  document.getElementById('overview').hidden = false;
  document.querySelector('.tabs').hidden = true;
  document.querySelector('main').hidden = true;
  document.getElementById('back-btn').hidden = true;
  window.scrollTo(0, 0);
}

document.querySelectorAll('.tab').forEach(b => b.addEventListener('click', showStory));
document.querySelectorAll('#overview .tile').forEach(t => t.addEventListener('click', () => openStory(t.dataset.target)));
document.getElementById('back-btn').addEventListener('click', backToOverview);

const ADMIN_PW = 'geheim';
const adminBtn = document.getElementById('admin-login');
const cms = document.getElementById('cms');
const list = document.getElementById('cms-list');

let config = {
  pageTitle: document.title,
  headerTitle: document.querySelector('h1').textContent,
  subtitle: document.querySelector('header p').textContent,
  stories: []
};

document.querySelectorAll('.story-panel').forEach((panel, i) => {
  const img = panel.querySelector('figure img');
  const tile = document.querySelector(`#overview .tile[data-target="${panel.id}"]`);
  const story = {
    id: panel.id,
    order: i + 1,
    visible: !panel.hidden,
    title: panel.querySelector('h2').textContent,
    text: panel.querySelector('.story-text').innerHTML,
    image: img ? img.getAttribute('src') : '',
    imageBelow: panel.querySelector('figure')?.classList.contains('below') || false,
    align: panel.querySelector('.story-text').classList.contains('align-center') ? 'center' : (panel.querySelector('.story-text').classList.contains('align-justify') ? 'justify' : 'left'),
    tileTitle: tile ? tile.querySelector('strong')?.textContent || panel.querySelector('h2').textContent : panel.querySelector('h2').textContent,
    tileDesc: tile ? tile.querySelector('.tile-text')?.innerHTML || '' : ''
  };
  config.stories.push(story);
});

try {
  const saved = localStorage.getItem('siteConfig');
  if (saved) config = JSON.parse(saved);
} catch (e) {}

applyConfig();

function applyConfig() {
  document.title = config.pageTitle;
  document.querySelector('h1').textContent = config.headerTitle;
  document.querySelector('header p').textContent = config.subtitle;
  const main = document.querySelector('main');
  const nav = document.querySelector('.tabs');
  const overview = document.getElementById('overview');
  config.stories.sort((a, b) => a.order - b.order).forEach((s, index) => {
    const section = document.getElementById(s.id);
    const tab = document.querySelector(`.tabs button[data-target="${s.id}"]`);
    const tile = document.querySelector(`#overview .tile[data-target="${s.id}"]`);
    if (!section || !tab || !tile) return;
    section.hidden = !s.visible;
    tab.hidden = !s.visible;
    tile.hidden = !s.visible;
    section.querySelector('h2').textContent = s.title;
    tab.textContent = index + 1;
    tile.innerHTML = `<strong>${s.tileTitle || s.title}</strong><span class="tile-text">${s.tileDesc || ''}</span>`;
    const textDiv = section.querySelector('.story-text');
    textDiv.innerHTML = s.text;
    textDiv.classList.remove('align-center', 'align-justify');
    if (s.align === 'center') textDiv.classList.add('align-center');
    if (s.align === 'justify') textDiv.classList.add('align-justify');
    const figure = section.querySelector('figure');
    if (figure) {
      const img = figure.querySelector('img');
      if (s.image) {
        img.src = s.image;
        img.style.display = '';
      } else {
        img.style.display = 'none';
      }
      figure.classList.toggle('below', s.imageBelow);
    }
    main.appendChild(section);
    nav.appendChild(tab);
    overview.appendChild(tile);
  });
}

function openCMS() {
  list.innerHTML = '';
  const g = document.createElement('div');
  g.innerHTML = `
    <h3>Globale Texte</h3>
    <label>Titel <input id="cfg-title" type="text" value="${config.pageTitle}"></label>
    <label>H1 <input id="cfg-header" type="text" value="${config.headerTitle}"></label>
    <label>Untertitel <input id="cfg-sub" type="text" value="${config.subtitle}"></label>
  `;
  list.appendChild(g);
  config.stories.forEach(story => {
    const div = document.createElement('div');
    div.className = 'story-item';
    div.dataset.id = story.id;
    div.innerHTML = `
      <h4>${story.id}</h4>
      <label>Sichtbar <input class="vis" type="checkbox" ${story.visible ? 'checked' : ''}></label>
      <label>Position <input class="order" type="number" value="${story.order}"></label>
      <label>Kachel-Titel <input class="tileTitle" type="text" value="${story.tileTitle}"></label>
      <label>Kurzbeschreibung</label><div class='editor-toolbar' data-target=".tileDesc"><button type='button' data-cmd='bold'><b>B</b></button><button type='button' data-cmd='italic'><i>I</i></button><button type='button' data-cmd='underline'><u>U</u></button></div><div class="tileDesc" contenteditable='true'>${story.tileDesc}</div>
      <label>Titel <input class="title" type="text" value="${story.title}"></label>
      <div class="editor-toolbar" data-target=".text">
        <button type="button" data-cmd="bold"><b>B</b></button>
        <button type="button" data-cmd="italic"><i>I</i></button>
        <button type="button" data-cmd="underline"><u>U</u></button>
      </div>
      <div class="text" contenteditable="true">${story.text}</div>
      <label>Bild <input class="img" type="file"></label>
      <img class="preview" src="${story.image}" ${story.image ? '' : 'style="display:none"'} alt="Vorschau">
      <label>Bildposition <select class="imgBelow">
          <option value="false">Rechts</option>
          <option value="true" ${story.imageBelow ? 'selected' : ''}>Unterhalb</option>
      </select></label>
      <label>Ausrichtung <select class="align">
          <option value="left" ${story.align === 'left' ? 'selected' : ''}>links</option>
          <option value="center" ${story.align === 'center' ? 'selected' : ''}>zentriert</option>
          <option value="justify" ${story.align === 'justify' ? 'selected' : ''}>Blocksatz</option>
      </select></label>
    `;
    div.querySelector('.img').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const r = new FileReader();
        r.onload = ev => {
          const url = ev.target.result;
          e.target.dataset.url = url;
          div.querySelector('.preview').src = url;
          div.querySelector('.preview').style.display = 'block';
          const imgCheck = new Image();
          imgCheck.onload = () => {
            const portrait = imgCheck.naturalHeight > imgCheck.naturalWidth;
            div.querySelector('.imgBelow').value = portrait ? 'true' : 'false';
          };
          imgCheck.src = url;
        };
        r.readAsDataURL(file);
      }
    });
    div.querySelectorAll(".editor-toolbar button").forEach(btn => {
      btn.addEventListener("click", () => {
        const cmd = btn.dataset.cmd;
        const target = div.querySelector(btn.closest(".editor-toolbar").dataset.target || ".text");
        if (target) {
          target.focus();
          document.execCommand(cmd, false, null);
        }
      });
    });
    list.appendChild(div);
  });
  cms.hidden = false;
}

adminBtn.addEventListener('click', () => {
  if (!adminBtn.dataset.auth) {
    const pw = prompt('Passwort:');
    if (pw !== ADMIN_PW) return;
    adminBtn.dataset.auth = '1';
  }
  openCMS();
});

document.getElementById('cms-close').addEventListener('click', () => {
  cms.hidden = true;
});

document.getElementById('cms-save').addEventListener('click', () => {
  config.pageTitle = document.getElementById('cfg-title').value;
  config.headerTitle = document.getElementById('cfg-header').value;
  config.subtitle = document.getElementById('cfg-sub').value;
  document.querySelectorAll('.story-item').forEach(div => {
    const id = div.dataset.id;
    const s = config.stories.find(st => st.id === id);
    s.visible = div.querySelector('.vis').checked;
    s.order = parseInt(div.querySelector('.order').value, 10) || 1;
    s.tileTitle = div.querySelector('.tileTitle').value;
    s.tileDesc = div.querySelector('.tileDesc').innerHTML;
    s.title = div.querySelector('.title').value;
    s.text = div.querySelector('.text').innerHTML;
    s.imageBelow = div.querySelector('.imgBelow').value === 'true';
    s.align = div.querySelector('.align').value;
    const imgInput = div.querySelector('.img');
    if (imgInput.dataset.url) s.image = imgInput.dataset.url;
  });
  localStorage.setItem('siteConfig', JSON.stringify(config));
  applyConfig();
  cms.hidden = true;
});

document.getElementById('cms-export').addEventListener('click', () => {
  const blob = new Blob([JSON.stringify(config, null, 2)], {type: 'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'geschichten-config.json';
  a.click();
});

</script>
</body>
</html>
